---
layout		: post
markdown	: kramdown
highlighter	: rouge
title		: Homomorphism in RSA
date		: 2022-06-01 00:00:00 +0900
category	: R&D
author		: λ°•μ§€μ›
author_email: sjoh@stealien.com
background	: /assets/bg.png
profile_image: /assets/stealien_inverse.png
summary		: "Homomorphism in RSA"
thumbnail	: /assets/stealien.png
lang        : ko
permalink   : /2022-06-01/homomorphism-in-rsa
---

# Homomorphism in RSA

# μ„λ΅ 

![001_markus-spiske-iar-afB0QQw-unsplash_edit.jpg](/assets/2022-06-08-homomorphism-in-rsa/001_markus-spiske-iar-afB0QQw-unsplash_edit.jpg)

ν•΄ν‚Ήμ— κ΄€μ‹¬μ„ κ°€μ§€κ² λ μ‚¬λμ΄λΌλ©΄ λ„κµ¬λ“ μ§€ κ·Έ μ‹¤λ ¥μ„ κΈ°λ¥΄κΈ° μ„ν•΄ μ›κ²μ„(Wargame) μ‚¬μ΄νΈμ—μ„ λ¬Έμ λ“¤μ„ ν’€κ±°λ‚ CTF(Capture The Flag) λ€νμ— μ¶μ „ν•΄ λ³Έ μ μ΄ μμ„ κ²ƒμ΄λ‹¤. μ›Ή(Web), λ¦¬λ²„μ‹±(Reversing), ν¬λ„λΈ”(Pwnable) λ“± μ—¬λ¬ λ¶„μ•Όμ λ¬Έμ λ“¤μ„ λ§λ‚λ³Ό μ μλ”λ°, νΉλ³„ν• κ²½μ°λ¥Ό μ μ™Έν•κ³  ν•­μƒ λ“±μ¥ν•λ” λ¶„μ•Όκ°€ μλ‹¤. λ°”λ΅ **μ•”νΈν•™(Cryptography)** λ¶„μ•Όμ΄λ‹¤.

μμ£Ό λ“±μ¥ν•λ” λ§νΌ ν¨κΈ° μκ² λ¬Έμ λ¥Ό ν’€μ–΄λ³΄λ ¤ ν•μ§€λ§ μ•”νΈν•™ λ¶„μ•Όμ λ¬Έμ λ¥Ό μ²μ μ ‘ν•΄λ³΄λ” μ‚¬λμ΄λΌλ©΄ λ„κµ¬λ“ μ§€ κ΄΄μƒν•κ² λ’¤μ£½λ°•μ£½ μ„μ—¬ μκ±°λ‚ μ«μλ΅λ§ λμ–΄ μλ” μ•”νΈλ¬Έμ„ λ°›μ•„λ³΄λ©° μ΄κ²ƒμ„ ν’€μ–΄μ„ μ •λ‹µμ„ μ μ¶ν•λΌλ” λ§μ— μ–΄λ–»κ² ν•΄μ•Ό ν• μ§€ μ‹μ‘λ¶€ν„° **λ§‰λ§‰ν–λ κ²½ν—**μ΄ μμ„ κ²ƒμ΄λ‹¤.

μ΄λ² κΈ€μ—μ„λ” μ•”νΈν•™μ΄λΌλ” λ¶„μ•Όμ— λ€ν•΄ λ§‰μ—°ν μ–΄λ µκ³  λ³µμ΅ν•λ‹¤κ³  μƒκ°ν•λ” μ‚¬λλ“¤μ„ μ„ν•΄ μ•”νΈν•™ λ¶„μ•Όμ μ›κ²μ„ λ¬Έμ μ—μ„ κ°€μ¥ ν”ν•κ² λ‚μ¤κ³  μ‹¤μ  ν•„λ“μ—μ„λ„ λ§μ΄ μ“°μ΄λ” κ³µκ°ν‚¤ μ•”νΈν™” κΈ°λ²•μ κΈ°λ³Έ μ¤‘μ κΈ°λ³Έ, **RSA** μ™€ κ΄€λ ¨λ λ¬Έμ λ¥Ό ν’€μ–΄λ³΄λ©° μ•”νΈν•™μ΄λΌλ” κ² κ·Έλ ‡κ² μ–΄λ µκ³  λ§‰λ§‰ν•κΈ°λ§ ν• κ²ƒμ€ μ•„λ‹λΌλ” μ μ„ λ°°μ›κ° μ μλ‹¤λ©΄ μΆ‹κ² λ‹¤.

---

# λ³Έλ΅ 

## κ·Έλμ„ RSA κ°€ λ­”κ°€μ”?

![002_RSA_inventors.jpeg](/assets/2022-06-08-homomorphism-in-rsa/002_RSA_inventors.jpeg)

RSA λ” 1978λ…„μ— μµμ΄λ΅ μ΄ μ•”νΈμ‹μ¤ν…μ„ μ—°κµ¬ν•μ—¬ μ²΄κ³„ν™”μ‹ν‚¨ Ron **R**ivest, Adi **S**hamir, Leonard **A**dleman μ μ΄λ¦„ μ• κΈ€μλ¥Ό λ”° λ§λ“¤μ–΄μ§„ **μ•”νΈν™”**λΏλ§ μ•„λ‹λΌ **μ „μμ„λ…**κΉμ§€ κ°€λ¥ν• μµμ΄μ μ•κ³ λ¦¬μ¦μ΄λ‹¤.

μ΄ RSA μ κ°•λ ¥ν•¨μ€ λ‹¤μ λ‘ κ°€μ§€μ—μ„ λ‚μ¨λ‹¤.

1. μ•”/λ³µνΈν™”, μ„λ…/κ²€μ¦μ— ν•„μ”ν• μν•™μ μΈ κ³„μ‚° κ³Όμ •μ΄ κµ‰μ¥ν κ°„λ‹¨ν•κ³  λΉ λ¥΄λ‹¤λ” κ²ƒ.
2. ν° μ«μμ μ†μΈμλ¶„ν•΄μ μ–΄λ ¤μ›€μ„ μ΄μ©ν• κ°•λ ¥ν• μ•μ „μ„±μ„ μ κ³µν•κ³  μλ‹¤λ” κ²ƒ.

μ„ λ‘ κ°€μ§€μ κ°•μ μΌλ΅ μΈν•΄ ν„μ¬κΉμ§€λ„ RSA λ” λ„λ¦¬ μ“°μ΄κ³  μλ‹¤.

λ‹¤μμΌλ΅λ” μ™ RSA μ κ°•μ μ„ μ„ λ‘ κ°€μ§€λ΅ κΌ½μ•λ”μ§€ ν‚¤ μƒμ„±λ¶€ν„° μ•”/λ³µνΈν™”, μ„λ…/κ²€μ¦ κ³Όμ •μ„ μ‚΄ν΄λ³΄λ©° μ•μ•„λ³΄λ„λ΅ ν•κ² λ‹¤.

## RSA ν‚¤ μƒμ„±

1. μ„λ΅ λ‹¤λ¥Έ **μ†μ p, q** λ¥Ό λλ¤ν•κ² μ„ νƒν•λ‹¤.
2. **n = p * q** λ¥Ό κ³„μ‚°ν•λ‹¤.
![003_n=pq.png](/assets/2022-06-08-homomorphism-in-rsa/003_npq.png)

3. n μ— λ€ν•μ—¬ **μ¤μΌλ¬ ν”Ό ν•¨μ(Eulerβ€™s phi (totient) function)** λλ” **μΉ΄λ§μ΄ν΄ ν•¨μ(Carmichael function)** μ¤‘ ν•λ‚λ¥Ό μ„ νƒν•μ—¬ κ³„μ‚°ν•λ‹¤.
    - μ¤μΌλ¬ ν”Ό ν•¨μ ([https://ko.wikipedia.org/wiki/μ¤μΌλ¬_ν”Ό_ν•¨μ](https://ko.wikipedia.org/wiki/%EC%98%A4%EC%9D%BC%EB%9F%AC_%ED%94%BC_%ED%95%A8%EC%88%98))
    ![004_phi.png](/assets/2022-06-08-homomorphism-in-rsa/004_phi.png)
    - μΉ΄λ§μ΄ν΄ ν•¨μ ([https://en.wikipedia.org/wiki/Carmichael_function](https://en.wikipedia.org/wiki/Carmichael_function))
    ![005_lambda.png](/assets/2022-06-08-homomorphism-in-rsa/005_lambda.png)
4. 3λ²μ—μ„ μ„ νƒν• μμ™€ **μ„λ΅μ†μΈ μ •μ e** λ¥Ό κ³ λ¥Έλ‹¤.
    
    (λ‘ μ •μ a, b μ μµλ€κ³µμ•½μ(gcd)κ°€ 1 μ΄λ©΄ λ‘μ€ μ„λ΅μ†μ΄λ‹¤.)
    
    (λ‘ μκ°€ μ„λ΅μ†κ°€ μ•„λ‹λ©΄ λ¨λ“λ¬ μ—­μ›μ„ κµ¬ν•  μ μ—†λ‹¤ β†’ κ°μΈν‚¤λ¥Ό κµ¬ν•  μ μ—†λ‹¤.)

    ![006_gcd_coprime.png](/assets/2022-06-08-homomorphism-in-rsa/006_gcd_coprime.png)

    (μΌλ°μ μΌλ΅ κ³„μ‚°μ ν¨μ¨μ„±μ„ μ„ν•΄ [νλ¥΄λ§ μ(Fermat Number)](https://ko.wikipedia.org/wiki/%ED%8E%98%EB%A5%B4%EB%A7%88_%EC%88%98)κ°€ μ„ νƒλλ‹¤.)

    ![007_Fermat_numbers.png](/assets/2022-06-08-homomorphism-in-rsa/007_Fermat_numbers.png)

5. μ •μ e μ— λ€ν• **λ¨λ“λ¬ μ—­μ›μΈ d** λ¥Ό κ³„μ‚°ν•λ‹¤.
![008_private_key_d.png](/assets/2022-06-08-homomorphism-in-rsa/008_private_key_d.png)

6. μ„μ—μ„ κ³„μ‚°ν• κ°’λ“¤ μ¤‘ **n, e λ¥Ό κ³µκ°ν‚¤**λ΅μ¨ λ°°ν¬ν•κ³ , **d λ¥Ό κ°μΈν‚¤**λ΅μ¨ μ λ€ λ…Έμ¶λμ§€ μ•κ² ν•λ‹¤.
![009_keys.png](/assets/2022-06-08-homomorphism-in-rsa/009_keys.png)

μ΄μ  ν•΄λ‹Ή κ³µκ°ν‚¤λ¥Ό μ΄μ©ν•μ—¬ λ„κµ¬λ“ μ§€ λ©”μ‹μ§€λ¥Ό μ•”νΈν™”ν•΄μ„ λ³΄λ‚΄λ©΄ κ°μΈν‚¤λ¥Ό κ°€μ§€κ³  μλ” μ†μ μλ§ ν•΄λ‹Ή λ©”μ‹μ§€λ¥Ό λ³µνΈν™”ν•  μ μλ‹¤. κ·Έλ ‡λ‹¤λ©΄ μ•”/λ³µνΈν™”λ” μ–΄λ–»κ² μν–‰λ κΉ? ν•λ² μ‚΄ν΄λ³΄μ.

## RSA μ•”νΈν™”

![010_enc.png](/assets/2022-06-08-homomorphism-in-rsa/010_enc.png)

## RSA λ³µνΈν™”

![011_dec.png](/assets/2022-06-08-homomorphism-in-rsa/011_dec.png)

μ„μ™€ κ°™μ΄ μ •λ§ κ°„λ‹¨ν•κ² μ•”/λ³µνΈν™”κ°€ μν–‰λλ©° μ΄μ— λ€ν• μ¦λ…μ€ [RSA μ„ν‚¤](https://en.wikipedia.org/wiki/RSA_(cryptosystem)#Proofs_of_correctness)μ— μƒμ„Έν•κ² λ‚μ™€μλ‹¤.

(νλ¥΄λ§ μ†μ •λ¦¬, μ¤μΌλ¬ μ •λ¦¬λ¥Ό μ΄μ©ν•μ—¬ μ¦λ…ν•¨)

μ΄λ²μ—λ” μ„λ…/κ²€μ¦μ΄ μ–΄λ–»κ² μν–‰λλ”μ§€ μ‚΄ν΄λ³΄μ.

## RSA μ„λ…

![012_sign.png](/assets/2022-06-08-homomorphism-in-rsa/012_sign.png)

## RSA κ²€μ¦

![013_verify.png](/assets/2022-06-08-homomorphism-in-rsa/013_verify.png)

μ•”/λ³µνΈν™” κ³Όμ •κ³Ό μμ„λ§ λ°”λ€μ—μ„ λΏ κ±°μ λ™μΌν•κ² μ„λ…/κ²€μ¦μ΄ μν–‰λλ©° μ„λ… μ‹ κ°μΈν‚¤ d λ¥Ό μ΄μ©ν•΄ μ„λ…μ΄ λκΈ° λ•λ¬Έμ— λ„κµ¬μ—κ²λ‚ κ³µκ°λλ” e λ¥Ό μ΄μ©ν•΄ λ©”μ‹μ§€ m μ„ λ³µμ›ν•  μ μ—†λ„λ΅ ν•΄μ‹ ν•¨μλ¥Ό μ΄μ©ν•μ—¬ λ©”μ‹μ§€ m μ ν•΄μ‹κ°’μΈ h μ— μ„λ…μ„ μ§„ν–‰ν•λ„λ΅ ν•λ‹¤.

λ©”μ‹μ§€μ— λ€ν• μ„λ…μ΄ μ™„λ£λμ—λ‹¤λ©΄ μ•”νΈν™”λ λ©”μ‹μ§€μ™€ μ„λ…μ„ ν•¨κ» μ „μ†΅ν•κ³  μ΄ν›„ κ²€μ¦ λ‹¨κ³„μ—μ„λ” λ³µνΈν™”λ λ©”μ‹μ§€μ ν•΄μ‹κ°’κ³Ό s^e (mod n) μ„ κ³„μ‚°ν•μ—¬ λ‚μ¨ ν•΄μ‹κ°’ h λ¥Ό λΉ„κµν•μ—¬ μΌμΉν•λ”μ§€ ν™•μΈν•λ©΄ λλ‹¤.

μ΄μ  RSA μ‹μ¤ν…μ— λ€ν• κΈ°λ³Έμ μΈ κ°λ…μ„ λ°°μ› μΌλ‹ ν¥λ―Έλ΅μ΄ μ†μ„± ν•λ‚λ¥Ό μ¶”κ°€λ΅ μ•λ ¤μ£Όλ ¤κ³  ν•λ‹¤.

## μ¤€λ™ν• μ‚¬μƒ(Homomorphism)

μ¤€λ™ν• μ‚¬μƒμ΄λ€ λ€μν•™μ—μ„ κµ¬μ΅°μƒ λ‹®μ€ λ‘ λ€μ κµ¬μ΅°μ λ¨λ“  μ—°μ‚° λ° κ΄€κ³„λ¥Ό λ³΄μ΅΄ν•λ” κ²½μ°λ¥Ό λ§ν•λ‹¤. μ‰½κ² λ§ν•μλ©΄, μ–΄λ– ν• ν•¨μ `f(x)` κ°€ μλ‹¤κ³  ν•  λ• `f(a * b)` κ°€ `f(a) * f(b)` μ™€ κ°™λ‹¤λ” κ²ƒμ΄λ‹¤ (λ‚λ—μ…λ„ λ§μ°¬κ°€μ§€). μ΄λ” μ‹ κΈ°ν•κ²λ„ RSA μ—λ„ κ·Έλ€λ΅ μ μ©μ΄ λλ”λ° ν‰λ¬Έ `m` μ΄ `a * b` λΌκ³  ν•  λ• c β‰΅ m^e (mod n) κ³Ό c β‰΅ (a * b)^e β‰΅ a^e * b^e (mod n) μ΄ μ„λ΅ μΌμΉν•λ‹¤. μ΄λ” μ„λ…μ—μ„λ„ λ§μ°¬κ°€μ§€μ΄λ©° μμ‹λ¥Ό ν†µν•΄ ν™•μΈν•΄λ³΄μ.

## μμ‹

1. μ„μμ μ†μ p, q μ„ νƒ
![014_pq.png](/assets/2022-06-08-homomorphism-in-rsa/014_pq.png)

2. n = p * q κ³„μ‚°
![015_n=pq=3233.png](/assets/2022-06-08-homomorphism-in-rsa/015_npq3233.png)

3. μ¤μΌλ¬ ν”Όν•¨μ κ³„μ‚°
![016_phi(n).png](/assets/2022-06-08-homomorphism-in-rsa/016_phi(n).png)

4. μ¤μΌλ¬ ν”Όν•¨μμ™€ μ„λ΅μ†μΈ μ •μ e μ„ νƒ
![017_e=17.png](/assets/2022-06-08-homomorphism-in-rsa/017_e17.png)

5. κ°μΈν‚¤ d κ³„μ‚°
![018_private_key_d.png](/assets/2022-06-08-homomorphism-in-rsa/018_private_key_d.png)

6. ν‰λ¬Έ m = a * b λΌκ³  ν•  λ• μ•”νΈν™” κ³Όμ • λΉ„κµ
![019_enc.png](/assets/2022-06-08-homomorphism-in-rsa/019_enc.png)

7. μ„λ… κ³Όμ • λΉ„κµ (κ³„μ‚° νΈμλ¥Ό μ„ν•΄ ν•΄μ‹ ν•¨μλ” λ―Έμ μ©)
![020_sign.png](/assets/2022-06-08-homomorphism-in-rsa/020_sign.png)

CTF μ RSA λ¬Έμ μ—μ„ μ„ μ†μ„±μ„ μ΄μ©ν• λ¬Έμ κ°€ κ½¤λ‚ μμ£Ό μ¶μ λλ©° ν•λ² μ‹¤μ λ΅ μ¶μ λ λ¬Έμ λ¥Ό ν’€μ–΄λ³΄λ©° μ–΄λ–¤ μ‹μΌλ΅ μ‘μ©λλ”μ§€ μ‚΄ν΄λ³΄μ.

## λ¬Έμ  ν’€μ΄

- LINECTF2022

| λ¬Έμ λ… | X Factor |
| --- | --- |
| λ‚μ΄λ„ | Easy |
| μ„¤λ… | Decrypt it! |
| μ κ³µνμΌ | [x_factor.md](/assets/2022-06-08-homomorphism-in-rsa/x_factor.md) |



λ¨Όμ €, μ κ³µλ νμΌμ„ μ—΄μ–΄μ„ ν™•μΈν•΄λ³΄μ.

**>> Part 1**

```python
I have generated a RSA-1024 key pair:
* public key exponent: 0x10001
* public key modulus: 0xa9e7da28ebecf1f88efe012b8502122d70b167bdcfa11fd24429c23f27f55ee2cc3dcd7f337d0e630985152e114830423bfaf83f4f15d2d05826bf511c343c1b13bef744ff2232fb91416484be4e130a007a9b432225c5ead5a1faf02fa1b1b53d1adc6e62236c798f76695bb59f737d2701fe42f1fbf57385c29de12e79c5b3
```

μ²«λ²μ§Έλ΅ `RSA κ³µκ°ν‚¤ μ(Public Exponent: e, Public Modulus: n)`μ„ 16μ§„μ ν•νƒλ΅ μ κ³µν•΄μ£Όκ³  μλ‹¤.

**>> Part 2**

```python
Here are some known plain -> signature pairs I generated using my private key:
* 0x945d86b04b2e7c7 -> 0x17bb21949d5a0f590c6126e26dc830b51d52b8d0eb4f2b69494a9f9a637edb1061bec153f0c1d9dd55b1ad0fd4d58c46e2df51d293cdaaf1f74d5eb2f230568304eebb327e30879163790f3f860ca2da53ee0c60c5e1b2c3964dbcf194c27697a830a88d53b6e0ae29c616e4f9826ec91f7d390fb42409593e1815dbe48f7ed4
* 0x5de2 -> 0x3ea73715787028b52796061fb887a7d36fb1ba1f9734e9fd6cb6188e087da5bfc26c4bfe1b4f0cbfa0d693d4ac0494efa58888e8415964c124f7ef293a8ee2bc403cad6e9a201cdd442c102b30009a3b63fa61cdd7b31ce9da03507901b49a654e4bb2b03979aea0fab3731d4e564c3c30c75aa1d079594723b60248d9bdde50
* 0xa16b201cdd42ad70da249 -> 0x9444e3fc71056d25489e5ce78c6c986c029f12b61f4f4b5cbd4a0ce6b999919d12c8872b8f2a8a7e91bd0f263a4ead8f2aa4f7e9fdb9096c2ea11f693f6aa73d6b9d5e351617d6f95849f9c73edabd6a6fde6cc2e4559e67b0e4a2ea8d6897b32675be6fc72a6172fd42a8a8e96adfc2b899015b73ff80d09c35909be0a6e13a
* 0x6d993121ed46b -> 0x2b7a1c4a1a9e9f9179ab7b05dd9e0089695f895864b52c73bfbc37af3008e5c187518b56b9e819cc2f9dfdffdfb86b7cc44222b66d3ea49db72c72eb50377c8e6eb6f6cbf62efab760e4a697cbfdcdc47d1adc183cc790d2e86490da0705717e5908ad1af85c58c9429e15ea7c83ccf7d86048571d50bd721e5b3a0912bed7c
* 0x726fa7a7 -> 0xa7d5548d5e4339176a54ae1b3832d328e7c512be5252dabd05afa28cd92c7932b7d1c582dc26a0ce4f06b1e96814ee362ed475ddaf30dd37af0022441b36f08ec8c7c4135d6174167a43fa34f587abf806a4820e4f74708624518044f272e3e1215404e65b0219d42a706e5c295b9bf0ee8b7b7f9b6a75d76be64cf7c27dfaeb
* 0x31e828d97a0874cff -> 0x67832c41a913bcc79631780088784e46402a0a0820826e648d84f9cc14ac99f7d8c10cf48a6774388daabcc0546d4e1e8e345ee7fc60b249d95d953ad4d923ca3ac96492ba71c9085d40753cab256948d61aeee96e0fe6c9a0134b807734a32f26430b325df7b6c9f8ba445e7152c2bf86b4dfd4293a53a8d6f003bf8cf5dffd
* 0x904a515 -> 0x927a6ecd74bb7c7829741d290bc4a1fd844fa384ae3503b487ed51dbf9f79308bb11238f2ac389f8290e5bcebb0a4b9e09eda084f27add7b1995eeda57eb043deee72bfef97c3f90171b7b91785c2629ac9c31cbdcb25d081b8a1abc4d98c4a1fd9f074b583b5298b2b6cc38ca0832c2174c96f2c629afe74949d97918cbee4a
```

λ‘λ²μ§Έλ΅ `(ν‰λ¬Έ - μ„λ…)` μ 7 κ°λ¥Ό 16μ§„μ ν•νƒλ΅ μ κ³µν•΄μ£Όκ³  μλ‹¤.

**>> Part 3**

```
**What is the signature of 0x686178656c696f6e?**

Take the least significant 16 bytes of the signature, encode them in lowercase hexadecimal and format it as `LINECTF{sig_lowest_16_bytes_hex}` to obtain the flag.
E.g. the last signature from the list above would become `LINECTF{174c96f2c629afe74949d97918cbee4a}`.
```

μ„Έλ²μ§Έλ΅ ν‰λ¬Έ `0x686178656c696f6e` μ **μ„λ…μ΄ λ¬΄μ—‡μΈμ§€** λ§μ¶°λ³΄λΌλ©° μ„λ…μ 16μ§„μ ν•νƒμ λ§μ§€λ§‰ 16 λ°”μ΄νΈλ¥Ό FLAG ν•μ‹μ— λ§μ¶° μ μ¶ν•λ©΄ λλ‹¤κ³  ν•λ‹¤.

ν„μ¬ μ°λ¦¬κ°€ μ•κ³  μλ” μ •λ³΄λ” `κ³µκ°ν‚¤(e, n)`μ™€ `(ν‰λ¬Έ - μ„λ…)` μ 7κ°, κ·Έλ¦¬κ³  FLAG μΈ μ„λ…μ„ κµ¬ν•κΈ° μ„ν•΄ ν•„μ”ν• ν‰λ¬Έ `0x686178656c696f6e` λΏμ΄λ‹¤. μλ―Έλ¥Ό μ• μ μ—†λ” 16μ§„μ ν•νƒμ μ«μλ΅λ§ κ°€λ“ν• ν…μ¤νΈλ΅λ¶€ν„° **μ–΄λ–»κ² κ°μΈν‚¤ d λ„ μ—†μ΄ μ„λ…μ„ κµ¬ν•  μ μμ„κΉ?**

λ°”λ΅ μ„μ—μ„ λ°°μ΄ μ¤€λ™ν• μ‚¬μƒ(Homomorphism)μ„ μ΄μ©ν•μ—¬ ν’€λ©΄ λλ‹¤.

λ¨Όμ € ν‰λ¬Έ `0x686178656c696f6e` μ„ μ†μΈμλ¶„ν•΄ ν•΄λ³΄λ©΄ λ‹¤μκ³Ό κ°™λ‹¤ (SageMath μ factor ν•¨μ):

```python
# Implemented in SageMath
target = 0x686178656c696f6e   # 7521425229691318126
factor(target)   # 2 * 197 * 947 * 2098711 * 9605087
```

μ„μ™€ κ°™μ΄ 5 κ°μ μ†μΈμμ κ³±μΌλ΅ ν‰λ¬Έμ„ ν‘ν„ν•  μ μλ‹¤λ” κ²ƒμ„ μ• μ μλ‹¤. (m = a * b * c * d * e)

μ΄λ²μ—λ” μ£Όμ–΄μ΅λ (ν‰λ¬Έ - μ„λ…) μμ—μ„ ν‰λ¬Έλ“¤λ§ μ†μΈμλ¶„ν•΄ ν•΄λ³΄λ©΄ λ‹¤μκ³Ό κ°™λ‹¤:

```python
pt1 = 0x945d86b04b2e7c7
pt2 = 0x5de2
pt3 = 0xa16b201cdd42ad70da249
pt4 = 0x6d993121ed46b
pt5 = 0x726fa7a7
pt6 = 0x31e828d97a0874cff
pt7 = 0x904a515
pts = [pt1, pt2, pt3, pt4, pt5, pt6, pt7]

for i in range(7):
    print(f"pt{i+1}: ", pts[i])
    print(f"factor(pt{i+1}): ", factor(pts[i]))
    print()

'''
[+] Output: 
pt1:  668178073886320583
factor(pt1):  811 * 947^3 * 970111

pt2:  24034
factor(pt2):  2 * 61 * 197

pt3:  12196433909207788967273033
factor(pt3):  970111 * 2098711^2 * 2854343

pt4:  1928075547694187
factor(pt4):  947 * 970111 * 2098711

pt5:  1919920039
factor(pt5):  61 * 197^2 * 811

pt6:  57538707471611677951
factor(pt6):  2098711 * 2854343 * 9605087

pt7:  151299349
factor(pt7):  197 * 811 * 947
'''
```

μ‹ κΈ°ν•κ²λ„ λ‡λ‡ μ†μΈμλ“¤μ΄ ν‰λ¬Έ `0x686178656c696f6e` μ **μ†μΈμλ“¤κ³Ό κ²ΉμΉλ‹¤**λ” κ²ƒμ„ ν™•μΈν•  μ μλ‹¤. μ†μΈμκ°€ κ²ΉμΉλ”κ² λ­ μ–΄λ–»κΈΈλ κ·Έλ°κ±ΈκΉ? μ°λ¦¬λ” 7 κ°μ `(ν‰λ¬Έ - μ„λ…)` μμ„ μ•κ³  μκΈ° λ•λ¬Έμ— ν•΄λ‹Ή ν‰λ¬Έμ„ **μ μ΅°ν•©**ν•΄μ„ ν‰λ¬Έ `0x686178656c696f6e` κ³Ό μΌμΉν•κ² λ§λ“ λ‹¤λ©΄ RSA μ—μ„μ **μ¤€λ™ν• μ‚¬μƒ**μΌλ΅ μΈν•΄ ν‰λ¬Έ `0x686178656c696f6e` μ— κ°μΈν‚¤ d λ¥Ό μ΄μ©ν•μ—¬ κ³„μ‚°ν• μ„λ…κ³Ό λ™μΌν• μ„λ…μ„ **κ°μΈν‚¤ d μ—†μ΄λ„ κµ¬ν•  μ μκ² λλ‹¤.**

## μ΄κ² λ¬΄μ¨ μ†λ¦¬?

μ„μ—μ„ ν‰λ¬Έ `0x686178656c696f6e` μ΄ 5 κ°μ μ†μΈμμ κ³± ν•νƒλ΅ ν‘ν„μ΄ κ°€λ¥ν•λ‹¤λ” κ²ƒμ„ μ•μ•λ‹¤.

![021_m_factor.png](/assets/2022-06-08-homomorphism-in-rsa/021_m_factor.png)

μ°λ¦¬λ” κ°μΈν‚¤ d λ¥Ό λ¨λ¥΄κΈ° λ•λ¬Έμ— m μ— λ€ν• μ„λ…μ„ κµ¬ν•  μ μ—†μ§€λ§, 7 κ°μ (ν‰λ¬Έ - μ„λ…) μμ„ μ•κ³  μκ³  κ° ν‰λ¬Έμ μ†μΈμκ°€ ν‰λ¬Έ `0x686178656c696f6e` μ μ†μΈμμ™€ κ²ΉμΉκΈ° λ•λ¬Έμ— κ³±ν•κΈ°μ™€ λ‚λ„κΈ°λ¥Ό μ μ ν μ΄μ©ν•μ—¬ ν‰λ¬Έ `0x686178656c696f6e` κ³Ό μΌμΉν•λ” μλ¥Ό κµ¬ν•  μ μλ‹¤λ©΄ ν•΄λ‹Ή μλ¥Ό κµ¬ν–μ„ λ•μ μ‹κ³Ό λ™μΌν•κ² 7 κ°μ μ„λ…μ— μ μ©ν•μ—¬ κ³„μ‚°ν•λ©΄ ν‰λ¬Έ `0x686178656c696f6e` μ— κ°μΈν‚¤ d λ¥Ό μ΄μ©ν•μ—¬ κ³„μ‚°ν• μ„λ…κ³Ό λ™μΌν• μ„λ…μ„ κ°μΈν‚¤ d μ—†μ΄λ„ κµ¬ν•  μ μκ² λλ‹¤λ” λ§μ΄λ‹¤.

![022_m_sign.png](/assets/2022-06-08-homomorphism-in-rsa/022_m_sign.png)

![023_find_m.png](/assets/2022-06-08-homomorphism-in-rsa/023_find_m.png)

![024_original_signature.png](/assets/2022-06-08-homomorphism-in-rsa/024_original_signature.png)

(ν„μ¬λ΅μ¨λ” κ³±ν•κΈ°, λ‚λ„κΈ° μ¤‘ μ–΄λ–¤ μ—°μ‚°μκ°€ λ“¤μ–΄κ°€μ•Ό ν•λ”μ§€ λ¨λ¥΄κΈ° λ•λ¬Έμ— λ¬Όμν‘(β€™?β€™)λ΅ λ‘μ—λ‹¤.)

ν‰λ¬Έ `0x686178656c696f6e` (target)κ³Ό μΌμΉν•λ” μλ¥Ό κµ¬ν•κΈ° μ„ν•΄μ„λ” μ•½κ°„μ λ¨Έλ¦¬λ¥Ό μ¨μ„ 7 κ°μ ν‰λ¬Έμ„ κ³±ν•κ³  λ‚λ„λ©΄ λλ‹¤. λ‚μ κ²½μ°μ—λ” μ‘μ€ μ†μΈμλ¥Ό κ°€μ§„ ν‰λ¬Έλ¶€ν„° μμ„λ€λ΅ λ‚μ—΄ν•΄λ³΄μ•λ‹¤.

```
pt2   : 2 * 61 * 197
pt5   :     61 * 197^2 * 811
pt7   :          197   * 811 * 947
pt1   :                  811 * 947^3 * 970111
pt4   :                        947   * 970111 * 2098711
pt3   :                                970111 * 2098711^2 * 2854343
pt6   :                                         2098711   * 2854343 * 9605087
-----------------------------------------------------------------------------
target: 2      * 197         * 947            * 2098711             * 9605087
```

μ΄μ  κ³±ν•κΈ°, λ‚λ„κΈ°λ¥Ό μ΄μ©ν•μ—¬ target κ³Ό μΌμΉν•λ” μλ¥Ό λ§λ“¤λ©΄ λλ‹¤.

```
    pt2: 2 * 61 * 197
(/) pt5:     61 * 197^2    * 811
-----------------------------------------------------------------------------------------
         2      * 197^(-1) * 811^(-1)
(*) pt7:          197      * 811      * 947
-----------------------------------------------------------------------------------------
         2                            * 947
(*) pt7:          197      * 811      * 947
-----------------------------------------------------------------------------------------
         2      * 197      * 811      * 947^2
(/) pt1:                     811      * 947^3    * 970111
-----------------------------------------------------------------------------------------
         2      * 197                 * 947^(-1) * 970111^(-1)
(*) pt4:                                947      * 970111 * 2098711
-----------------------------------------------------------------------------------------
         2      * 197                                     * 2098711
(*) pt4:                                947      * 970111 * 2098711
-----------------------------------------------------------------------------------------
         2      * 197                 * 947      * 970111 * 2098711^2
(/) pt3:                                           970111 * 2098711^2 * 2854343
-----------------------------------------------------------------------------------------
         2      * 197                 * 947                           * 2854343^(-1)
(*) pt6:                                                    2098711   * 2854343 * 9605087
-----------------------------------------------------------------------------------------
 answer: 2      * 197                 * 947               * 2098711             * 9605087

Therefore, answer = pt2 / pt5 * pt7^2 / pt1 * pt4^2 / pt3 * pt6.
```

7 κ°μ ν‰λ¬Έμ„ μ΄μ©ν•μ—¬ ν‰λ¬Έ `0x686178656c696f6e` (target)κ³Ό μΌμΉν•λ” μ(answer)λ¥Ό κµ¬ν–κΈ° λ•λ¬Έμ— μ΄μ  7 κ°μ μ„λ…μ„ μ΄μ©ν•μ—¬ λ™μΌν• μ‹μΌλ΅ target μ μ„λ…μ„ κµ¬ν•  μ μλ‹¤.

μ•„λλ” target μ μ„λ…κ³Ό FLAG λ¥Ό κµ¬ν•κΈ° μ„ν•΄ μ‚¬μ©ν• μ½”λ“μ΄λ‹¤.

```python
# Implemented in SageMath
target = 0x686178656c696f6e
print("target: ", target)   # 7521425229691318126
print("factor(target): ", factor(target))   # 2 * 197 * 947 * 2098711 * 9605087
print()

answer = pt2 / pt5 * pt7^2 / pt1 * pt4^2 / pt3 * pt6
print("answer: ", answer)   # 7521425229691318126
print("factor(answer): ", factor(answer))   # 2 * 197 * 947 * 2098711 * 9605087
print()
assert target == answer

# Using the same formula as answer including modular n.
# This is possible because of the homomorphism in unpadded RSA.
newsig = (sig2 / sig5 * sig7^2 / sig1 * sig4^2 / sig3 * sig6) % n
print("newsig (int): ", newsig)
# 111219533890621461179460792242241632450808153632799554790302537773885731996725665970159819970061237994467913213678895572474822930918390150774003109045699291202079975387595071497569834504251162974827309324614046581068300485342202365281472704413710935864495616184160512233863134373547246784976501532318112012352
newsig = hex(newsig)[2:]
print("newsig (hex): ", newsig)
# 9e61c276f698ec48aab7dabfd663f3b2ee75d31c68bf16f6810a3bb9bb1c377e47b2ae8cd7055c7c5848bbedc94798d2965c38b317e42191df0e3f25ca2ee58c5f3e125745479b337516a13e420da29ba48a92ca2ee9720487cda6cdf070e83a4a251c52e331174a0ef642a97a251462a049347a7db8226d496eb55c15b1d840
print()

'''
Take the least significant 16 bytes of the signature, encode them in lowercase hexadecimal and format it as `LINECTF{sig_lowest_16_bytes_hex}` to obtain the flag.
E.g. the last signature from the list above would become `LINECTF{174c96f2c629afe74949d97918cbee4a}`.
'''
flag = 'LINECTF{' + str(newsig[-32:]) + '}'
print("flag: ", flag)
# flag:  LINECTF{a049347a7db8226d496eb55c15b1d840}
```

<aside>
π© FLAG : LINECTF{a049347a7db8226d496eb55c15b1d840}

</aside>

---

# κ²°λ΅ 

![025_philip-estrada-vJr3t39a0xw-unsplash_edit.jpg](/assets/2022-06-08-homomorphism-in-rsa/025_philip-estrada-vJr3t39a0xw-unsplash_edit.jpg)

μ§€κΈκΉμ§€ **RSA** λ€ λ¬΄μ—‡μΈμ§€, **ν‚¤ μƒμ„±**, **μ•”/λ³µνΈν™”**, **μ„λ…/κ²€μ¦**μ€ μ–΄λ–»κ² μ΄λ£¨μ–΄μ§€λ”μ§€ μ•μ•„λ³΄μ•κ³ , λ λ€μν•™μ—μ„μ **μ¤€λ™ν• μ‚¬μƒ(Homomorphism)** κ°λ…μ„ CTF μ—μ„ μμ£Ό μ¶μ λλ” μ ν•μ RSA λ¬Έμ μ— μ μ©ν•μ—¬ ν’€μ–΄λ³΄μ•λ‹¤. μ΄μ™Έμ—λ„ μλ§μ€ λ°©μ‹μ RSA κ³µκ²© κΈ°λ²•λ“¤μ΄ μ΅΄μ¬ν•μ§€λ§ λ€λ¶€λ¶„ μ„ λ¬Έμ  ν’€μ΄μ—μ„ λ³Έ κ²ƒκ³Ό κ°™μ΄ μν•™μ μΈ κ°λ…μ„ κ°€μ§€κ³  μ‚¬μΉ™μ—°μ‚°λ§ ν•  μ¤„ μ•λ‹¤λ©΄ κΈλ°© μ΄ν•΄ν•κ³  κ·Έκ²ƒμ„ λ¬Έμ μ— μ μ©ν•  μ μμ„ κ²ƒμ΄λ‹¤.

**μ•”νΈ**λ¥Ό ν‘Όλ‹¤λ” κ²ƒμ€ **μ–½νκ³ μ„¤ν‚¨ μ‹¤νƒ€λλ¥Ό ν‘Έλ” κ²ƒ**κ³Όλ„ κ°™λ‹¤κ³  μƒκ°ν•λ‹¤. μ²μ λ¬Έμ λ¥Ό μ ‘ν–μ„ λ•λ” λ„λ¬΄μ§€ μ–΄λ–»κ² μ΄κ²ƒμ„ ν’€μ–΄μ•Ό ν•λ‹¤λ” κ±΄μ§€ κ°μ„ μ΅μ„ μμ΅°μ°¨ μ—†μ§€λ§ μ²μ²ν λ‘λ¬λ³΄λ‹¤ λ³΄λ©΄ λ¬Έμ λ¥Ό ν•΄κ²°ν•  μ μλ” **μ‹¤λ§λ¦¬**λ¥Ό μ΅μ„ μ μμ„ κ²ƒμ΄λ‹¤. μ΄ κΈ€μ΄ μ•”νΈν•™ λ¬Έμ λ¥Ό ν‘Έλ” μ΄λ“¤μ—κ² μΆ‹μ€ μ‹μ‘μ μ΄ λκΈ°λ¥Ό κΈ°μ›ν•λ©° κΈ€μ„ λ§λ¬΄λ¦¬ν•λ„λ΅ ν•κ² λ‹¤.