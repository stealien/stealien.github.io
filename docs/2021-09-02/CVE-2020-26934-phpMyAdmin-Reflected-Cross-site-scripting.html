<!DOCTYPE html>
<html lang="en">
<head><meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta property="og:type" content="article">
<meta property="og:image" content="http://ufo.stealien.com/assets/og_image.png">
<meta property="og:title" content="STEALIEN Technical Blog">
<meta property="og:description" content="CVE-2020-26934 - phpMyAdmin Reflected Cross-site scripting">
<link href="https://fonts.googleapis.com/css?family=Nunito+Sans:400,400i,700&display=swap" rel="stylesheet">
<title>CVE-2020-26934 - phpMyAdmin Reflected Cross-site scripting</title>
<!-- Begin Jekyll SEO tag v2.7.1 -->
<title>CVE-2020-26934 - phpMyAdmin Reflected Cross-site scripting | STEALIEN Technical Blog</title>
<meta name="generator" content="Jekyll v4.2.0" />
<meta property="og:title" content="CVE-2020-26934 - phpMyAdmin Reflected Cross-site scripting" />
<meta name="author" content="고기완" />
<meta property="og:locale" content="ko" />
<meta name="description" content="개요 phpMyAdmin은 MySQL/MariaDB 데이터베이스를 관리하기 위한 웹 인터페이스 서비스다. PHP 언어로 구현되어 있으며 웹서버에 설치하여 사용한다. 사용자는 웹 브라우저를 통해 phpMyAdmin 웹페이지에 로그인한 후, 데이터베이스 열람 및 수정이 가능하다." />
<meta property="og:description" content="개요 phpMyAdmin은 MySQL/MariaDB 데이터베이스를 관리하기 위한 웹 인터페이스 서비스다. PHP 언어로 구현되어 있으며 웹서버에 설치하여 사용한다. 사용자는 웹 브라우저를 통해 phpMyAdmin 웹페이지에 로그인한 후, 데이터베이스 열람 및 수정이 가능하다." />
<link rel="canonical" href="http://0.0.0.0:4000/2021-09-02/CVE-2020-26934-phpMyAdmin-Reflected-Cross-site-scripting" />
<meta property="og:url" content="http://0.0.0.0:4000/2021-09-02/CVE-2020-26934-phpMyAdmin-Reflected-Cross-site-scripting" />
<meta property="og:site_name" content="STEALIEN Technical Blog" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-09-02T15:55:50+09:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="CVE-2020-26934 - phpMyAdmin Reflected Cross-site scripting" />
<script type="application/ld+json">
{"@type":"BlogPosting","url":"http://0.0.0.0:4000/2021-09-02/CVE-2020-26934-phpMyAdmin-Reflected-Cross-site-scripting","datePublished":"2021-09-02T15:55:50+09:00","mainEntityOfPage":{"@type":"WebPage","@id":"http://0.0.0.0:4000/2021-09-02/CVE-2020-26934-phpMyAdmin-Reflected-Cross-site-scripting"},"author":{"@type":"Person","name":"고기완"},"description":"개요 phpMyAdmin은 MySQL/MariaDB 데이터베이스를 관리하기 위한 웹 인터페이스 서비스다. PHP 언어로 구현되어 있으며 웹서버에 설치하여 사용한다. 사용자는 웹 브라우저를 통해 phpMyAdmin 웹페이지에 로그인한 후, 데이터베이스 열람 및 수정이 가능하다.","headline":"CVE-2020-26934 - phpMyAdmin Reflected Cross-site scripting","dateModified":"2021-09-02T15:55:50+09:00","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name=“naver-site-verification” content=“74a9ec74d48a1ffca92bf9ac4704ba73be9afd65" />
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous"/>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
<link rel="stylesheet" href="/assets/css/style.css">

<link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic:wght@400;700;800&display=swap" rel="stylesheet">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.3/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.0.3/highlight.min.js"></script>

<link href="/assets/css/syntax.css" rel="stylesheet" >


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-06FFJEF76M"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-06FFJEF76M');
</script>
</head>
<body>
	<header>
		<div class="container"></div><div id="header">
    <div class="container" style="display: flex;justify-content: space-between;">
        <a href="/">
            <img
                class="header_image_logo"
                src="/assets/logo.png"
                style="width: 140px; margin: 20px 28px 0px;"
            />
        </a>
        <a href="https://www.stealien.com/" target="_blank" style="font-family: 'NotoSansKR Medium', sans-serif;font-size: 14px;margin-right: 30px; color: #000; line-height: 70px;">스틸리언 홈페이지</a>
    </div>
</div>
</header>
	<section>
		<div>
			<div class="header_image_bg header_image_post" style="background-image: url('/assets/bg.png');">
    <div class="header_image_post_body">
        <div class="container">
            <div class="page-category">R&D</div>
            <div class="page-title">CVE-2020-26934 - phpMyAdmin Reflected Cross-site scripting</div>
            <div class="page-summary">
                <div style="float:left;">
                    <img class="page-profile_image" src="/assets/2021-08-20-CVE-2020-26934/profile.png" />
                    <span>고기완</span>
                </div>
                <div style="float:right;" class="page-date">Sep 2, 2021</div>
            </div>
        </div>
    </div>
</div>
<div class="container page-content">
    <h1 id="개요">개요</h1>
<p>phpMyAdmin은 MySQL/MariaDB 데이터베이스를 관리하기 위한 웹 인터페이스 서비스다. PHP 언어로 구현되어 있으며 웹서버에 설치하여 사용한다. 사용자는 웹 브라우저를 통해 phpMyAdmin 웹페이지에 로그인한 후, 데이터베이스 열람 및 수정이 가능하다.</p>

<h1 id="변환transformation-기능">변환(Transformation) 기능</h1>
<p>데이터베이스의 값을 표시 또는 삽입할 때 데이터의 변환 방식을 지정하는 기능이다.
변환 기능을 이용하는 예시는 다음과 같다.</p>
<ul>
  <li>테이블 구조 변경 기능에서 아래 이미지와 같이 Media type, Browser display transformation 등을 지정한다.</li>
</ul>

<p><img src="/assets/2021-08-20-CVE-2020-26934/cve202026934_1.png" style="max-width:800px; height:auto;" /></p>

<ul>
  <li>변환 기능이 적용된 테이블의 데이터를 표시할 때, 변환된 데이터를 보기 위해 [BLOB]을 클릭하면 transformation_wrapper.php 페이지로 이동된다.</li>
</ul>

<p><img src="/assets/2021-08-20-CVE-2020-26934/cve202026934_2.png" style="max-width:800px; height:auto;" /></p>

<ul>
  <li>transformation_wrapper.php 페이지는 쿼리 구문을 입력 받아 실행하고, 실행 결과를 변환하여 표시한다.</li>
</ul>

<h1 id="취약점-설명">취약점 설명</h1>
<p>transformation_wrapper.php는 CSRF 토큰을 필요로 하지 않는다. CSRF 토큰 검증을 하지 않으므로, 공격자가 GET 요청 방식으로 파라미터 전달이 가능하다. 
$request_params 변수에 선언된 ‘cn’, ‘ct’, ‘sql_query’, ‘transform_key’, ‘where_clause’를 파라미터로 받아, 해당 변수명으로 사용한다.</p>

<p><img src="/assets/2021-08-20-CVE-2020-26934/cve202026934_3.png" style="max-width:800px; height:auto;" /></p>

<p>where_clause 파라미터는 SELECT 쿼리 구문의 WHERE 절에 삽입해 실행된다. 
쿼리 실행 결과를 출력하기 전, Core::downloadHeader 함수를 실행한다. Core::downloadHeader 함수는 /libraries/classes/Core.php에 선언되어 있다. 
두 개의 인자를 받아 파일 다운로드와 관련된 HTTP 응답 헤더를 지정한다. 첫 번째 인자는 파일 이름이고, 두 번째 인자는 Content-Type을 지정한다.</p>

<p><img src="/assets/2021-08-20-CVE-2020-26934/cve202026934_4.png" style="max-width:800px; height:auto;" /></p>

<p>공격자가 ct 파라미터를 조작하면, Core::downloadHeader 함수의 두 번째 인자가 조작되어 Content-Type 조작이 가능하다.
Core::downloadHeader 함수가 종료되고 쿼리 실행 결과를 출력한다.</p>

<p><img src="/assets/2021-08-20-CVE-2020-26934/cve202026934_5.png" style="max-width:800px; height:auto;" /></p>

<p>Content-Type을 html으로 지정하는 경우, PHP의 htmlspecialchars 함수를 통해 XSS 문자열이 필터링된다. 공격자는 XSS 필터링을 우회하며 웹브라우저 화면에 출력하기 위해 Content-Type을 text/xml 으로 지정한다.
Content-Type이 text/xml이므로 쿼리 실행으로 출력 되는 내용을 XML XSS으로 지정하면 XSS 취약점이 발생한다.
출력 되는 내용을 조작하기 위해 where_clause 파라미터에 UNION SELECT 구문을 넣는다.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1 UNION SELECT '&lt;?xml version="1.0"?&gt;&lt;html&gt;&lt;script xmlns="http://www.w3.org/1999/xhtml"&gt;alert(1)&lt;/script&gt;&lt;/html&gt;',2,3,0 ORDER BY 4
</code></pre></div></div>

<p>위 SQL 구문을 삽입하는 전체 페이로드는 아래와 같다.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~/index.php?target=transformation_wrapper.php&amp;db=information_schema&amp;table=CHARACTER_SETS&amp;where_clause=1%20UNION%20SELECT%20%27%3C?xml%20version=%221.0%22?%3E%3Chtml%3E%3Cscript%20xmlns=%22http://www.w3.org/1999/xhtml%22%3Ealert(1)%3C/script%3E%3C/html%3E%27,2,3,0%20ORDER%20BY%204&amp;cn=&amp;ct=text/xml&amp;transform_key=CHARACTER_SET_NAME
</code></pre></div></div>

<p><img src="/assets/2021-08-20-CVE-2020-26934/cve202026934_6.png" style="max-width:800px; height:auto;" /></p>

<h1 id="패치-내역">패치 내역</h1>
<p>phpMyAdmin에 해당 취약점을 제보하고 CVE-2020-26934으로 패치되었다.</p>

<p>https://www.phpmyadmin.net/security/PMASA-2020-5/</p>

<p>Thanks to Giwan Go, Yelang Lee of STEALIEN for reporting this vulnerability.</p>

<p>공격자가 GET 요청 방식으로 파라미터 전달을 하지 못하도록 where_clause 파라미터의 서명값을 검증한다.</p>

<p><img src="/assets/2021-08-20-CVE-2020-26934/cve202026934_7.png" style="max-width:800px; height:auto;" /></p>

    <div class="page-profile-detail">
        <div class="page-profile-detail-info">
            <div>
                <img class="page-profile_image-detail" src="/assets/2021-08-20-CVE-2020-26934/profile.png" />
            </div>
            <div style="position: relative; top: 12px;left: 10px;">
                <div class="page-profile-author">고기완</div>
                <div class="page-profile-email">gogil@stealien.com</div>
            </div>
        </div>
    </div>
</div>

<div class="recent-post-area">
    <div class="posts container">
        <div class="h1-recent-post">RECENT POST</div>
            <div class="row">
    <div class="col-sm-2 col-md-2">
        <div class="profile">
            <img src="/assets/2022-10-04-Secure-Coding-Training-System/profile.jpeg" class="profile_image" />
            <div class="profile_author">윤석찬</div>
        </div>
    </div>
    <div class="col">
        <a href="/2022-10-04/secure-coding-traing-system">
            <div class="post-title">
                Secure Coding Training System 개발기
            </div>
        </a>
        <div class="post-summary">경희대학교 SW 보안대회 운영기</div>
        <div class="post-info">
            <span style="color: #545454" class="post-author-mobile">
                윤석찬
                <span style="color: #f5f5f5; margin: 2px">|</span>
            </span>
            Oct 4, 2022
            <span style="color: #f5f5f5; margin: 2px">|</span>
            <span>R&D</span>
        </div>
    </div>
</div><div class="row">
    <div class="col-sm-2 col-md-2">
        <div class="profile">
            <img src="/assets/stealien_inverse.png" class="profile_image" />
            <div class="profile_author">조장현</div>
        </div>
    </div>
    <div class="col">
        <a href="/2022-07-13/llvm-flow-flatten">
            <div class="post-title">
                LLVM을 사용한 Control Flow Flattening 패스 개발
            </div>
        </a>
        <div class="post-summary">LLVM으로 Control Flow Flattening 구현</div>
        <div class="post-info">
            <span style="color: #545454" class="post-author-mobile">
                조장현
                <span style="color: #f5f5f5; margin: 2px">|</span>
            </span>
            Jul 13, 2022
            <span style="color: #f5f5f5; margin: 2px">|</span>
            <span>Dev</span>
        </div>
    </div>
</div>
        </div>
    </div>
</div>
		</div>
	</section><footer>
  <div class="container" style="display: flex; justify-content: space-between;">
    <!-- <a href="#top">
      <img src="/assets/white_logo.png" class="footer-logo" />
    </a> -->
    <div class="footer-copyright">Copyright &copy; Stealien Inc.</div>
    <div class="footer-icons">
      <a target="_blank" href="https://twitter.com/stealien"><img class="sns" src="/assets/icons/twitter_ic.png"/></a>
      <a target="_blank" href="https://blog.naver.com/stealien_official"><img class="sns" src="/assets/icons/blog_ic.png"/></a>
      <a target="_blank" href="https://www.facebook.com/stealien/"><img class="sns" src="/assets/icons/facebook_ic.png"/></a>
      <a target="_blank" href="https://www.youtube.com/c/STEALIEN"><img class="sns" src="/assets/icons/youtube_ic.png"/></a>
    </div>
  </div>
</footer></body>
</html>
